<html>
    <head>
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
        <script type="text/javascript" src="jquery.min.js"></script>
        <script type="text/javascript" src="kendo.all.min.js"></script>
        <link rel="stylesheet" href="ticketAdderStyle.css">
    </head>
    <body>
        <div class="my_cont">
            <nav class="navbar my_nav" style="width: inherit !important; height:3% !important">
                <div class="container" style="width:inherit !important">
                    <ul class="nav navbar-nav navbar-right" style="margin-right: 1% !important">
                        <li><a class="btn btn-default">New</a></li>
                    </ul>
                </div>
            </nav>
            <div class="activity_inner">
                <div class="activity_container">
                    <div class="activity_item">
                        Hello
                        <span class="activity_item_icons">
                            <span class="glyphicon glyphicon-plus"></span>
                            <span class="glyphicon glyphicon-minus"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <script>
            function bind() {
                $(".glyphicon-plus").off("click");
                $(".glyphicon-plus").on("click", function(e){
                    $(".activity_inner").append(`
                    <div class="activity_item">
                        ${Math.round(Math.random() * 20)}
                        <span class="activity_item_icons">
                            <span class="glyphicon glyphicon-plus"></span>
                            <span class="glyphicon glyphicon-minus"></span>
                        </span>
                    </div>`
                    );
                    
                    bind();
                });

                function before_or_after(event, target) {
                    var rect = target.getBoundingClientRect();
                    var y = event.clientY;
                    var distTop = Math.abs(y - rect.top);
                    var distBot = Math.abs(y - rect.bottom);
                    var centre = Math.abs(distTop-distBot);
                    if (centre <= 7) {
                        return -1;
                    } else if (distTop > distBot) {
                        return 0; //after
                    } else {
                        return 1; //before
                    }
                }

                function push_to_parent(parent, child) {
                    if (parent.parentContainer === undefined) {
                        $(parent).after("<div class='parent_container'></div>");
                        parent.parentContainer = $(parent).next(".parent_container")[0];
                        return push_to_parent(parent, child);
                    } else {
                        if (parent !== child) {
                            $(parent.parentContainer).append(child);
                        }
                    }
                }
                
                $(".activity_item").kendoDraggable({
                    hint: function(e){return e.clone()},
                    drag: function(e) {
                        $("hr.indicator").remove();
                        var hover = e.elementUnderCursor;
                        var i = "<hr class='indicator'/>";
                        var r = -1;
                        if ($(".activity_inner")[0].contains(hover) && $(".activity_inner")[0] !== hover) {
                            r = before_or_after(e, hover);
                            if (r == 0) {
                                $(hover).after(i);
                            } else if (r == 1) {
                                $(hover).before(i);
                            }
                        }
                    }
                },);

                $(".activity_item").kendoDropTarget({
                    drop: function(e){
                        $("hr.indicator").remove();
                        var t = e.dropTarget[0];
                        var r = before_or_after(e, t);
                        var elem = e.draggable.element[0];
                        if (r == 1) {
                            $(t).before(elem);
                        } else if (r == 0) {
                            $(t).after(elem);
                        } else {
                            push_to_parent(t, elem);
                        }
                        if (elem.parentContainer && $(elem).next() !== elem.parentContainer) {
                                $(elem).after(elem.parentContainer);
                        }
                    }
                });
            }

            bind();
        </script>
    </body>
</html>
